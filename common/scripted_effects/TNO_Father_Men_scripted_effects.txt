### Peasant Uprising ###

OMO_reduce_peasant_uprising = {
	custom_effect_tooltip = OMO_deal_with_peasant_uprisings_tt
	hidden_effect = {
		if = {
			limit = {
				has_idea = OMO_peasant_uprisings
			}
			swap_ideas = {
				remove_idea = OMO_peasant_uprisings
				add_idea = OMO_peasant_uprisings_2
			}
		}
		else_if = {
			limit = {
				has_idea = OMO_peasant_uprisings_2
			}
			swap_ideas = {
				remove_idea = OMO_peasant_uprisings_2
				add_idea = OMO_peasant_uprisings_3
			}
		}
	}
}

OMO_clear_peasant_uprising = {
	custom_effect_tooltip = OMO_deal_with_peasant_uprisings_tt
	hidden_effect = {
		if = {
			limit = {
				has_idea = OMO_peasant_uprisings
			}
			remove_ideas = OMO_peasant_uprisings
		}
		else_if = {
			limit = {
				has_idea = OMO_peasant_uprisings_2
			}
			remove_ideas = OMO_peasant_uprisings_2
		}
		else_if = {
			limit = {
				has_idea = OMO_peasant_uprisings_3
			}
			remove_ideas = OMO_peasant_uprisings_3
		}
	}
}

### Temptations of the Sinner ###

OMO_give_in_to_temptation = {
	add_popularity = {
		ideology = communist
		popularity = 0.08
	}
	add_to_variable = { OMO_sudoplatov_influence = 25 }
	clamp_variable = { var = OMO_sudoplatov_influence min = 0 max = 100 }
	custom_effect_tooltip = OMO_sudoplatov_influence_increase_tt
	if = {
		limit = {
			check_variable = { OMO_sudoplatov_influence > 76 }
		}
		country_event = { id = OMO.28 days = 1 }
	}
}

OMO_medium_temptation = {
	add_popularity = {
		ideology = communist
		popularity = 0.06
	}
	add_to_variable = { OMO_sudoplatov_influence = 10 }
	clamp_variable = { var = OMO_sudoplatov_influence min = 0 max = 100 }
	custom_effect_tooltip = OMO_sudoplatov_influence_increase_tt
	if = {
		limit = {
			check_variable = { OMO_sudoplatov_influence > 76 }
		}
		country_event = { id = OMO.28 days = 1 }
	}
}

OMO_minor_temptation = {
	add_popularity = {
		ideology = communist
		popularity = 0.03
	}
	add_to_variable = { OMO_sudoplatov_influence = 5 }
	clamp_variable = { var = OMO_sudoplatov_influence min = 0 max = 100 }
	custom_effect_tooltip = OMO_sudoplatov_influence_increase_tt
	if = {
		limit = {
			check_variable = { OMO_sudoplatov_influence > 76 }
		}
		country_event = { id = OMO.28 days = 1 }
	}
}

OMO_OMS_collapse_west_siberia = { #collapsing West Siberia using Omsk failure =)
	hidden_effect = {
		OMS = {
			transfer_state = 571
			clear_global_event_target = RUS_west_siberia_unifier
			hidden_effect = {
				remove_mission = OMS_put_down_batovs_bandits
				remove_mission = OMS_batov_making_moves
				remove_decision = OMS_acquire_more_bases
				remove_decision = OMS_build_base
				remove_decision = OMS_dismantle_own_base
				remove_decision = OMS_attack_enemy_base
				remove_decision = OMS_rally_people_against_batov
				remove_decision = OMS_intensify_operations
			}
			set_global_flag = OMS_BatovInsurrectionSuccess
			kill_country_leader = yes
			add_political_power = -100
			add_stability = -0.35
			add_war_support = -0.35
			add_ideas = OMS_collapsed_central_authority
			promote_character = OMS_Collapsed_Authority
			set_popularities = {
				ultranationalism = 100
			}
			delete_unit_template_and_units = {
				division_template = "Strelkovaya Diviziya"
			}
			delete_unit_template_and_units = {
				division_template = "Iskupitelnaya Brigada"
			}
			delete_unit_template_and_units = {
				division_template = "Kavaleriyskaya Diviziya"
			}
			delete_unit_template_and_units = {
				division_template = "Gruppa Zashchity"
			}
			delete_unit_template_and_units = {
				division_template = "Chernaya Gvardiya"
			}
			country_lock_all_division_template = yes
			load_focus_tree = shattered_ambitions
			promote_character = OMS_Collapsed_Authority_despot
			remove_ideas = {
				OMS_new_boss
				OMS_fueled_by_revenge
				OMS_nothing_left_to_lose
				OMS_nothing_left_to_lose_2
				OMS_the_shield
				OMS_idea_plan_hydra
				OMS_idea_quiet_war
				OMS_leadership_secured
				OMS_idea_dispersed_industry
				OMS_vorkuta_nkvd
				OMS_securing_the_people_idea
				OMS_an_end_to_luxury
				OMS_an_end_to_luxury_2
				OMS_a_plan_for_russia
				OMS_a_plan_for_russia_2
				OMS_a_new_sibplan_idea
				OMS_project_kamera_idea
				OMS_isd_field_commissars_idea
				OMS_expanded_auxiliaries
			}
			remove_all_ministers = yes
			add_ideas = {
				OMS_Generic_Vacant_hog
				OMS_Generic_Vacant_for
				OMS_Generic_Vacant_eco
				OMS_Generic_Vacant_sec
			}
			tno_worsen_army_professionalism = yes
			tno_worsen_army_professionalism = yes

			756 = {
				set_demilitarized_zone = yes
			}
			871 = {
				set_demilitarized_zone = yes
			}
			845 = {
				set_demilitarized_zone = yes
			}
			844 = {
				set_demilitarized_zone = yes
			}
			573 = {
				set_demilitarized_zone = yes
			}
			579 = {
				set_demilitarized_zone = yes
			}
			756 = {
				set_demilitarized_zone = no
			}
			871 = {
				set_demilitarized_zone = no
			}
			845 = {
				set_demilitarized_zone = no
			}
			844 = {
				set_demilitarized_zone = no
			}
			573 = {
				set_demilitarized_zone = no
			}
			579 = {
				set_demilitarized_zone = no
			}

			YGR = {
				drop_cosmetic_tag = yes
				transfer_state = 756
				transfer_state = 845
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_cosmetic_tag = YGR_OMSK_COLLAPSE
				set_politics = {
					ruling_party = despotism
				}
				add_popularity = {
					ideology = despotism
					popularity = 0.5
				}
				diplomatic_relation = {
					country = ZLT
					relation = military_access
					active = no
				}
				remove_ideas = SIB_terror_bombing
				promote_character = YGR_OMS_Collapse_Soslanbek_Apayev
				load_focus_tree = shattered_ambitions
			}
			FAV = {
				drop_cosmetic_tag = yes
				transfer_state = 844
				transfer_state = 579
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_cosmetic_tag = FAV_OMSK_COLLAPSE
				set_politics = {
					ruling_party = communist
				}
				add_popularity = {
					ideology = communist
					popularity = 0.7
				}
				promote_character = FAV_OMS_Collapse_Valentin_Shashin
				remove_ideas = {
					SIB_terror_bombing
					FAV_night_witches
					FAV_aerial_society
					FAV_collective_improvisation
				}
				remove_all_ministers = yes
				add_ideas = {
					FAV_Generic_Vacant_hog
					FAV_Generic_Vacant_eco
					FAV_Generic_Vacant_for
					FAV_Generic_Vacant_sec
				}
				load_focus_tree = shattered_ambitions
			}
			NTG = {
				drop_cosmetic_tag = yes
				transfer_state = 871
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_cosmetic_tag = NTG_OMSK_COLLAPSE
				set_party_name = {
					ideology = communist
					long_name = OMS_communist_nizhny_party_long
					name = OMS_communist_nizhny_party
				}
				load_focus_tree = shattered_ambitions
			}
			ZLT = {
				drop_cosmetic_tag = yes
				transfer_state = 573
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_cosmetic_tag = ZLT_OMSK_COLLAPSE
				set_politics = {
					ruling_party = ultranationalism
				}
				set_popularities = {
					ultranationalism = 100
				}
				set_party_name = {
					ideology = ultranationalism
					long_name = OMS_ultranationalism_zlatoust_party_long
					name = OMS_ultranationalism_zlatoust_party
				}
				promote_character = ZLT_OMS_Collapse_Konstantin_Pastanogov
				remove_ideas = {
					SIB_terror_bombing
					ZLT_golden_republic
					ZLT_the_two_consuls
				}
				remove_all_ministers = yes
				add_ideas = {
					ZLT_Generic_Vacant_hog
					ZLT_Generic_Vacant_eco
					ZLT_Generic_Vacant_for
					ZLT_Generic_Vacant_sec
				}
				diplomatic_relation = {
					country = YGR
					relation = military_access
					active = no
				}
				load_focus_tree = shattered_ambitions
			}
			580 = {
				set_demilitarized_zone = yes
			}
			653 = {
				set_demilitarized_zone = yes
			}
			754 = {
				set_demilitarized_zone = yes
			}
			572 = {
				set_demilitarized_zone = yes
			}
			403 = {
				set_demilitarized_zone = yes
			}
			580 = {
				set_demilitarized_zone = no
			}
			653 = {
				set_demilitarized_zone = no
			}
			754 = {
				set_demilitarized_zone = no
			}
			572 = {
				set_demilitarized_zone = no
			}
			403 = {
				set_demilitarized_zone = no
			}
			SVR = {
				promote_character = SVR_Pavel_Batov
				set_country_leader_description = {
					desc = "POLITICS_PAVEL_BATOV_OMSK_COLLAPSE_DESC"
				}
				SVR_Pavel_Batov = {
					set_portraits = {
						army = { large = "gfx/leaders/SVR/Portrait_Sverdlovsk_Punished_Pavel_Batov.dds" }
						civilian = { large = "gfx/leaders/SVR/Portrait_Sverdlovsk_Punished_Pavel_Batov.dds" }
					}
				}
				set_politics = {
					ruling_party = paternalism
				}
				set_party_name = {
					ideology = paternalism
					long_name = OMS_paternalism_batov_party_long
					name = OMS_paternalism_batov_party
				}
				transfer_state = 403
				transfer_state = 580
				transfer_state = 653
				transfer_state = 754
				transfer_state = 572
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_cosmetic_tag = SVR_OMSK_COLLAPSE
				remove_all_ministers = yes
				add_ideas = {
					RUS_shattered_ambitions
					SVR_Ivan_Bagramyan_hog
					SVR_Yelena_Karbysheva_for
					SVR_Ernest_Voznesensky_eco
					SVR_Hamazasp_Babadzhanian_sec
				}
				remove_ideas = {
					SIB_terror_bombing
					SVR_notso_redarmy
					SVR_black_league_influence_tier_1
					SVR_revisionist_influence_tier_2
				}
				load_focus_tree = shattered_ambitions
			}
			
			VOR = {
				transfer_state = 863
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_politics = {
					ruling_party = paternalism
				}
				set_popularities = {
					paternalism = 100
				}
				set_party_name = {
					ideology = paternalism
					long_name = OMS_paternalism_vorkuta_party_long
					name = OMS_paternalism_vorkuta_party
				}
				set_cosmetic_tag = VOR_OMSK_COLLAPSE
				promote_character = VOR_Viktor_Kolesnikov
				remove_ideas = { 
					SIB_terror_bombing
					VOR_security_state
				}
				remove_all_ministers = yes
				add_ideas = {
					VOR_Generic_Vacant_hog
					VOR_Generic_Vacant_eco
					VOR_Generic_Vacant_for
					VOR_Generic_Vacant_sec
				}
			}
			SGV = {
				promote_character = SGV_Evgeny_Savintsev
				transfer_state = 581
				every_owned_state = {
					remove_core_of = OMS
					add_core_of = PREV
				}
				set_party_name = {
					ideology = ultranationalism
					long_name = OMS_paternalism_spetsgruppa_party
					name = OMS_paternalism_spetsgruppa_party
				}
			}
			OMS = { set_cosmetic_tag = OMS_OMSK_COLLAPSE }
			if = {
				limit = {
					NOT = { country_exists = URL }
				}
				URL = {
					add_country_leader_role = {
						character = URL_Hadji_Umar_Mamsurov
						promote_leader = yes
						country_leader = {
							desc = "POLITICS_HADJI_UMAR_MAMSUROV_OMSK_COLLAPSE_DESC"
							expire = "1999.1.1"
							ideology = paternalism_stratocracy_subtype
							traits = { }
							id = -1
						}
					}
					remove_ideas = {
						URL_children_of_vorkuta
						URL_refugee_crisis
					}
					remove_all_ministers = yes
					add_ideas = {
						URL_Generic_Vacant_hog
						URL_Generic_Vacant_for
						URL_Generic_Vacant_eco
						URL_Generic_Vacant_sec
					}
				}
			}
			every_owned_state = {
				limit = {
					OR = {
						is_core_of = ORE
						is_core_of = URL
						is_core_of = MGN
						is_core_of = DRL
					}
				}
				URL = {
					transfer_state = PREV
					add_state_core = PREV
				}
				remove_core_of = OMS
			}
			if = {
				limit = { has_global_flag = RUS_SOUTHERN_URALS_CRISIS_OVER }
				WSR = {
					set_country_flag = BEGUN_SOUTHERN_URALS_CRISIS
					clr_country_flag = RUS_RFTU_preparing_invasion
					RUS_urals_influence_initialise = yes
				}
				clr_global_flag = RUS_SOUTHERN_URALS_CRISIS_OVER
			}
		}
		OMO = {
			if = {
				limit = {
					has_war = yes
				}
				every_enemy_country = {
					every_country = {
						limit = {
							is_west_siberian_nation = yes
						}
						save_global_event_target_as = WEST_SIBERIA_declare_war
						PREV = {
							declare_war_on = {
								target = event_target:WEST_SIBERIA_declare_war
								type = annex_everything
							}
						}
					}
				}
				clear_global_event_target = WEST_SIBERIA_declare_war
			}
		}
	}
}